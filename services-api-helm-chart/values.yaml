# Your env's name
envName: test.helm

image:
  pullPolicy: IfNotPresent
  repository: quay.io/octopize/avatar-service-api

# The image tag version. It's a good idea to pin it to something specific.
# Avoid using "latest".
avatarServiceApiVersion: 0.0.1
pdfgeneratorVersion: 0.1.4

# Octopize will provide you with this, it should be base64 encoded.
dockerPullSecret: "TODO"

# Db connection
dbHost: 127.0.0.1
dbPort: "5432"
dbName: "avatar"
dbUsername: "avatar"
# For instance: python -c "import secrets; print(secrets.token_hex(), end='')"
dbPassword: ""

dbAdminUsername: ""
dbAdminPassword: ""

resources:
  apiReplicas: 1
  pdfgeneratorReplicas: 1
  apiMemoryRequest: "4Gi"
  pdfgeneratorMemoryRequest: "2Gi"

  apiCpuRequest: "1000m"
  pdfgeneratorCpuRequest: "1000m"

# TODO: Nest these in a pdfgenerator: subsection
pdfgeneratorHost: "avatar-pdf"
pdfgeneratorPort: 8001

ingress:
  useGCP: false
  gcp:
    staticIpName: ""
    managedCertificateName: ""

# GCP-specific configuration
gcp:
  useGCP: false
  # For SQL Proxy
  ksaName: ""
  gsaEmail: ""
  dbInstanceConnectionName: ""

debug:
  storage:
    # If true, creates a PersistentVolumeClaim and mounts it to the API pods.
    # Otherwise, we expect the shared storage to be specified in the ConfigMap and point
    # to a remote storage (s3:// or gs://).
    useLocal: false

web:
  image: 
    registry: quay.io
    repository: octopize/avatar-web
    tag: "0.0.6"
    pullPolicy: "IfNotPresent"
  replicas: 1
  resources: 
    memoryRequest: "2Gi"
    cpuRequest: "500m"
  port: 3000
  config:
    storageEndpointPublicHost: "https://avatar.storage.yourcompany.com"
    storageEndpointPublicPort: ""
    storageEndpointInternalHost: ""
    storageEndpointInternalPort: 8333
    apiPublicHost: "https://avatar.yourcompany.com/api"
    apiPublicPort: ""
    apiInternalHost: "http://avatar-api"
    apiInternalPort: 8000
    ssoEnabled: "false"
    ssoUrl: "https://avatar.yourcompany.com/sso/"
    envName: "prod"

api:
  # TODO: Nest all of these in a config: subsection,
  #       as this is the config that is used for the API app,
  #       not only the API deployment/pod.
  #       This will require modifying the values in the pulumi program
  # Externally accessible API url (should be with https)
  baseUrl: https://avatar.yourcompany.com/api
  
  # This Url is the customer facing url for the web client
  # It will typically be used to format emails.
  webClientUrl: https://avatar.yourcompany.com

  daskSchedulerUrl: "dask-scheduler:8786"

  isTelemetryEnabled: true
  isSentryEnabled: true
  logLevel: "INFO"
  deleteFilesUsingCronjob: false

  pepper: TODO   # python -c "import secrets; print(secrets.token_hex(), end='')"
  authjwtSecretKey: TODO   # python -c "import secrets; print(secrets.token_hex(), end='')"
  # python -c "import base64; import os; print(str(base64.urlsafe_b64encode(os.urandom(32)), encoding='utf-8'), end='')"
  fileEncryptionKey: TODO


  # If useEmailAuthentication is true, provide only adminEmail. Else, provide
  # firstUserName and firstUserPassword.
  useEmailAuthentication: false
  organizationName: ""
  adminEmails: 
    - ""
  firstUserName: ""
  firstUserPassword: ""   # python -c "import secrets; print(secrets.token_hex(), end='')"

  # Path to s3:// or gs://
  sharedStoragePath: ""
  storageEndpointHost: ""
  storageEndpointPort: 8333
  accessControlEndpointHost  : ""
  accessControlEndpointPort  : 8111
  fileJwtSecretKey: TODO

  storageAdminAccessKeyId: ""
  storageAdminSecretAccessKey: ""

  awsStorageAccountAccessKeyId: ""
  awsStorageAccountSecretAccessKey: ""

  # AWS Mail account used to send mails for password reset
  awsMailAccountAccessKeyId: ""
  awsMailAccountSecretAccessKey: ""

  maxAllowedDimensionsPerDataset: "200"
  maxAllowedLinesPerDataset: "2000000"

  # Clevercloud constant
  clevercloudSsoSalt: ""

  # Values for telemetry
  s3TelemetryEndpointUrl: ""
  s3TelemetryRegion: ""
  s3TelemetryBucketName: ""
  s3TelemetryAccessKeyId: ""
  s3TelemetrySecretAccessKey: ""

  ssoClientId: ""
  ssoClientSecret: ""
  ssoProviderAppName: ""
  ssoProviderUrl: ""

authentik:
  enabled: true

  global:
    image:
      tag: 2025.12.1

  authentik:
    secret_key: ""

    # Configure authentik to use the external PostgreSQL database
    # The database and user are created automatically by the authentik-db-init Job hook
    postgresql:
      host: 127.0.0.1
      port: 5432
      name: authentik
      user: authentik
      password: ""

    log_level: info

    disable_startup_analytics: true
    disable_update_check: true

    error_reporting:
      enabled: false

    # Email configuration for password resets and notifications
    # Leave empty to disable email functionality
    email:
      host: "email-smtp.eu-west-3.amazonaws.com"  # SMTP server hostname (e.g., smtp.gmail.com)
      port: 587  # SMTP port (587 for TLS, 465 for SSL, 25 for unencrypted)
      username: ""  # SMTP username
      password: ""  # SMTP password
      from: "noreply@octopize.io"  # Email address emails are sent from
      use_tls: true  # Use STARTTLS for connection security
      use_ssl: false  # Use SSL/TLS for connection security (can't be enabled at same time as use_tls)
      timeout: 30  # Connection timeout in seconds

  worker:
    resources: {}
      # limits:
      #   cpu: 500m
      #   memory: 512Mi
      # requests:
      #   cpu: 200m
      #   memory: 256Mi

    replicas: 1
    
    volumes:
      - name: custom-email-templates
        configMap:
          name: authentik-custom-templates
      - name: branding-assets
        configMap:
          name: authentik-branding
    
    volumeMounts:
      # Mount custom templates directory so authentik can discover them in the UI
      # Templates will appear in the email stage dropdown
      - name: custom-email-templates
        mountPath: /templates/custom
        readOnly: true
      # Mount branding assets using subPath to only overwrite specific files
      - name: branding-assets
        mountPath: /media/public/favicon.ico
        subPath: favicon.ico
        readOnly: true
      - name: branding-assets
        mountPath: /media/public/brand_logo.png
        subPath: logo.png
        readOnly: true

  # Server configuration to mount custom templates
  # Mirror the same configuration as worker for consistency
  server:
    volumes:
      - name: custom-email-templates
        configMap:
          name: authentik-custom-templates
      - name: branding-assets
        configMap:
          name: authentik-branding
    
    volumeMounts:
      # Mount custom templates directory so authentik can discover them in the UI
      # Templates will appear in the email stage dropdown
      - name: custom-email-templates
        mountPath: /templates/custom
        readOnly: true
      # Mount branding assets using subPath to only overwrite specific files
      - name: branding-assets
        mountPath: /media/public/favicon.ico
        subPath: favicon.ico
        readOnly: true
      - name: branding-assets
        mountPath: /media/public/brand_logo.png
        subPath: logo.png
        readOnly: true